<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <title>学校联系进展</title>
  <style>
    :root{
      --bg: #f0f2f8;
      --card: rgba(255,255,255,0.95);
      --text: #0f172a;
      --muted: #64748b;
      --border: rgba(15, 23, 42, 0.08);
      --shadow: 0 8px 32px rgba(2, 6, 23, 0.06), 0 2px 8px rgba(2, 6, 23, 0.04);
      --shadow2: 0 6px 24px rgba(2, 6, 23, 0.05), 0 1px 6px rgba(2, 6, 23, 0.03);
      --shadow-hover: 0 16px 48px rgba(2, 6, 23, 0.10), 0 4px 12px rgba(2, 6, 23, 0.06);
      --ring: rgba(59,130,246,0.30);
      --ok-bg: rgba(16,185,129,0.12);
      --ok-fg: #059669;
      --no-bg: rgba(239,68,68,0.10);
      --no-fg: #dc2626;
      --warn-bg: rgba(245,158,11,0.12);
      --warn-fg: #d97706;
      --info-bg: rgba(59,130,246,0.10);
      --info-fg: #2563eb;
      --chip-bg: rgba(255,255,255,0.82);
      --accent: #3b82f6;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg: #0a0f1e;
        --card: rgba(17, 24, 42, 0.82);
        --text: #e5e7eb;
        --muted: #9ca3af;
        --border: rgba(255,255,255,0.08);
        --shadow: 0 8px 32px rgba(0,0,0,0.45), 0 2px 8px rgba(0,0,0,0.30);
        --shadow2: 0 6px 24px rgba(0,0,0,0.35), 0 1px 6px rgba(0,0,0,0.25);
        --shadow-hover: 0 20px 56px rgba(0,0,0,0.55), 0 6px 16px rgba(0,0,0,0.35);
        --ring: rgba(96,165,250,0.35);
        --chip-bg: rgba(17, 24, 39, 0.72);
        --ok-fg: #34d399;
        --no-fg: #fb7185;
        --warn-fg: #fbbf24;
        --info-fg: #60a5fa;
        --ok-bg: rgba(16,185,129,0.16);
        --no-bg: rgba(244,63,94,0.16);
        --warn-bg: rgba(245,158,11,0.16);
        --info-bg: rgba(59,130,246,0.16);
        --accent: #60a5fa;
      }
    }
    *{ box-sizing: border-box; }
    html{ height: 100%; scroll-behavior: smooth; }
    body{ height: 100%; }
    body{
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue",
                   Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      color: var(--text);
      background:
        radial-gradient(1000px 600px at 5% -15%, rgba(99,102,241,0.14), transparent 55%),
        radial-gradient(800px 500px at 50% -5%, rgba(59,130,246,0.10), transparent 50%),
        radial-gradient(900px 500px at 95% 5%, rgba(16,185,129,0.12), transparent 50%),
        var(--bg);
      background-attachment: fixed;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }
    a{ color: inherit; }
    .wrap{
      width: min(960px, calc(100% - 32px));
      margin: 0 auto;
      padding: 16px 0 calc(100px + env(safe-area-inset-bottom));
    }
    /* page transition animation */
    @keyframes fadeSlideIn{
      from{ opacity: 0; transform: translateY(8px); }
      to{ opacity: 1; transform: translateY(0); }
    }
    .body > *{
      animation: fadeSlideIn 320ms cubic-bezier(0.22, 1, 0.36, 1) both;
    }
    .body > *:nth-child(2){ animation-delay: 60ms; }
    .body > *:nth-child(3){ animation-delay: 120ms; }
    .body > *:nth-child(4){ animation-delay: 180ms; }
    .body > *:nth-child(5){ animation-delay: 240ms; }
    .body > *:nth-child(6){ animation-delay: 300ms; }
    .body > *:nth-child(7){ animation-delay: 360ms; }
    .top{
      position: sticky;
      top: 0;
      z-index: 10;
      padding: 14px 0 12px;
      background: linear-gradient(to bottom, rgba(240,242,248,0.92), rgba(240,242,248,0.70), transparent);
      backdrop-filter: blur(16px) saturate(1.4);
      -webkit-backdrop-filter: blur(16px) saturate(1.4);
    }
    .top, .bottomNav{
      transition: transform 280ms cubic-bezier(0.22, 1, 0.36, 1), opacity 280ms ease;
      will-change: transform;
    }
    body.navHidden .top{
      transform: translateY(-120%);
      opacity: 0;
      pointer-events: none;
    }
    @media (prefers-color-scheme: dark){
      .top{
        background: linear-gradient(to bottom, rgba(10,15,30,0.90), rgba(10,15,30,0.65), transparent);
      }
    }
    .headerCard{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .headerMain{
      padding: 14px 14px 12px;
      display: grid;
      gap: 10px;
    }
    .titleRow{
      display: grid;
      gap: 4px;
    }
    h1{
      margin: 0;
      font-size: 19px;
      line-height: 1.2;
      letter-spacing: -0.2px;
      font-weight: 800;
    }
    .meta{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      color: var(--muted);
      font-size: 12.5px;
    }
    .chip{
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--chip-bg);
      font-size: 12px;
      backdrop-filter: blur(8px);
    }
    .summary{
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }
    @media (min-width: 520px){
      .summary{ grid-template-columns: repeat(4, minmax(0, 1fr)); }
    }
    .kpi{
      padding: 12px 10px 10px;
      border: 1px solid var(--border);
      border-radius: 16px;
      background: rgba(255,255,255,0.42);
    }
    @media (prefers-color-scheme: dark){
      .kpi{ background: rgba(0,0,0,0.18); }
    }
    .kpi .n{
      font-size: 22px;
      font-weight: 800;
      letter-spacing: -0.5px;
      line-height: 1;
    }
    .kpi .l{
      margin-top: 5px;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.3px;
      font-weight: 600;
    }
    .kpi.ok .n{ color: var(--ok-fg); }
    .kpi.no .n{ color: var(--no-fg); }
    .kpi.warn .n{ color: var(--warn-fg); }
    .kpi.info .n{ color: var(--info-fg); }
    .body{
      display: grid;
      gap: 14px;
      margin-top: 12px;
    }
    .section{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: var(--shadow2);
      overflow: hidden;
      transition: box-shadow 300ms ease;
    }
    .sectionHead{
      padding: 16px 16px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(to bottom, rgba(255,255,255,0.55), transparent);
    }
    @media (prefers-color-scheme: dark){
      .sectionHead{ background: linear-gradient(to bottom, rgba(0,0,0,0.22), transparent); }
    }
    .sectionHead h2{
      margin: 0;
      font-size: 14.5px;
      font-weight: 800;
      letter-spacing: -0.1px;
    }
    .legend{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    .tag{
      display: inline-flex;
      align-items: center;
      padding: 5px 11px;
      border-radius: 999px;
      font-size: 11.5px;
      font-weight: 700;
      letter-spacing: 0.3px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.65);
      transition: transform 150ms ease, box-shadow 150ms ease;
    }
    @media (prefers-color-scheme: dark){
      .tag{ background: rgba(0,0,0,0.22); }
    }
    .tag.ok{ background: var(--ok-bg); color: var(--ok-fg); border-color: rgba(16,185,129,0.22); }
    .tag.no{ background: var(--no-bg); color: var(--no-fg); border-color: rgba(239,68,68,0.22); }
    .tag.warn{ background: var(--warn-bg); color: var(--warn-fg); border-color: rgba(245,158,11,0.24); }
    .tag.info{ background: var(--info-bg); color: var(--info-fg); border-color: rgba(59,130,246,0.22); }
    .cards{
      padding: 14px 16px 16px;
      display: grid;
      gap: 14px;
    }
    .card{
      border: 1px solid var(--border);
      border-radius: 18px;
      background: rgba(255,255,255,0.75);
      overflow: hidden;
      position: relative;
      transition: transform 220ms cubic-bezier(0.22, 1, 0.36, 1), box-shadow 220ms ease, border-color 220ms ease;
    }
    .card::before{
      content: '';
      position: absolute;
      left: 0;
      top: 12px;
      bottom: 12px;
      width: 3px;
      border-radius: 0 3px 3px 0;
      background: var(--border);
      opacity: 0.6;
      transition: opacity 220ms ease, background 220ms ease;
    }
    .card.statusOk::before{ background: var(--ok-fg); opacity: 0.7; }
    .card.statusNo::before{ background: var(--no-fg); opacity: 0.7; }
    .card.statusWarn::before{ background: var(--warn-fg); opacity: 0.7; }
    .card.statusInfo::before{ background: var(--info-fg); opacity: 0.7; }
    @media (hover: hover){
      .card:hover{
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
        border-color: rgba(59,130,246,0.16);
      }
      .card:hover::before{ opacity: 1; }
    }
    @media (prefers-color-scheme: dark){
      .card{ background: rgba(255,255,255,0.04); }
    }
    .cardTop{
      padding: 14px 14px 10px 18px;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 10px;
    }
    .school{
      min-width: 0;
      display: grid;
      gap: 4px;
    }
    .school .cn{
      font-size: 15px;
      font-weight: 800;
      letter-spacing: -0.1px;
      line-height: 1.2;
    }
    .school .en{
      font-size: 12.5px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .rows{
      padding: 0 14px 14px 18px;
      display: grid;
      gap: 10px;
    }
    .row{
      display: grid;
      grid-template-columns: 72px 1fr;
      gap: 10px;
      align-items: start;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(248,250,252,0.70);
    }
    @media (prefers-color-scheme: dark){
      .row{ background: rgba(255,255,255,0.05); }
    }
    .row .label{
      font-size: 12.5px;
      font-weight: 760;
      color: var(--muted);
      padding-top: 2px;
    }
    .row .value{
      display: grid;
      gap: 6px;
    }
    .note{
      font-size: 12.5px;
      color: var(--muted);
      line-height: 1.4;
    }
    .actions{
      padding: 12px 14px 14px;
      display: grid;
      gap: 10px;
    }
    .action{
      border: 1px solid var(--border);
      border-radius: 18px;
      background: rgba(255,255,255,0.75);
      padding: 14px 14px;
      display: grid;
      gap: 8px;
      transition: transform 220ms cubic-bezier(0.22, 1, 0.36, 1), box-shadow 220ms ease;
    }
    @media (hover: hover){
      .action:hover{
        transform: translateY(-1px);
        box-shadow: var(--shadow);
      }
    }
    @media (prefers-color-scheme: dark){
      .action{ background: rgba(255,255,255,0.04); }
    }
    .actionTop{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .when{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 850;
      letter-spacing: 0.2px;
      font-size: 13px;
    }
    .what{
      font-size: 14px;
      font-weight: 780;
      line-height: 1.3;
      letter-spacing: -0.1px;
    }
    .detail{
      font-size: 12.5px;
      color: var(--muted);
      line-height: 1.45;
    }
    .prio{
      font-size: 11.5px;
      font-weight: 700;
      padding: 5px 11px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.60);
      color: var(--muted);
      white-space: nowrap;
    }
    @media (prefers-color-scheme: dark){
      .prio{ background: rgba(0,0,0,0.22); }
    }
    .prio.high{ color: var(--no-fg); border-color: rgba(239,68,68,0.25); background: rgba(239,68,68,0.10); }
    .prio.mid{ color: var(--warn-fg); border-color: rgba(245,158,11,0.25); background: rgba(245,158,11,0.10); }
    .prio.low{ color: var(--info-fg); border-color: rgba(59,130,246,0.25); background: rgba(59,130,246,0.10); }
    .foot{
      margin-top: 16px;
      color: var(--muted);
      font-size: 11.5px;
      line-height: 1.5;
      padding: 0 4px;
      opacity: 0.8;
    }
    .focusable:focus{
      outline: none;
      box-shadow: 0 0 0 4px var(--ring);
      border-color: rgba(59,130,246,0.40);
    }
    @media print{
      body{ background: #fff; }
      .top{ position: static; background: transparent; backdrop-filter: none; }
      .headerCard, .section{ box-shadow: none; }
    }

    .btn{
      appearance: none;
      -webkit-appearance: none;
      border: 0;
      background: transparent;
      color: inherit;
      font: inherit;
      padding: 0;
      text-align: left;
    }

    .kpiBtn{
      width: 100%;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      background: rgba(255,255,255,0.70);
      box-shadow: 0 2px 8px rgba(2, 6, 23, 0.06);
      transition: transform 200ms cubic-bezier(0.22, 1, 0.36, 1), box-shadow 200ms ease, border-color 200ms ease, background 200ms ease;
      border-radius: 16px;
    }
    .kpiBtn.ok{
      border-color: rgba(16,185,129,0.20);
      background: linear-gradient(135deg, rgba(16,185,129,0.12), rgba(16,185,129,0.04));
    }
    .kpiBtn.no{
      border-color: rgba(239,68,68,0.20);
      background: linear-gradient(135deg, rgba(239,68,68,0.10), rgba(239,68,68,0.03));
    }
    .kpiBtn.warn{
      border-color: rgba(245,158,11,0.22);
      background: linear-gradient(135deg, rgba(245,158,11,0.12), rgba(245,158,11,0.04));
    }
    .kpiBtn.info{
      border-color: rgba(59,130,246,0.20);
      background: linear-gradient(135deg, rgba(59,130,246,0.12), rgba(59,130,246,0.04));
    }
    @media (prefers-color-scheme: dark){
      .kpiBtn{
        background: rgba(0,0,0,0.20);
        box-shadow: 0 2px 8px rgba(0,0,0,0.25);
      }
      .kpiBtn.ok{ border-color: rgba(16,185,129,0.24); background: linear-gradient(135deg, rgba(16,185,129,0.16), rgba(0,0,0,0.12)); }
      .kpiBtn.no{ border-color: rgba(244,63,94,0.24); background: linear-gradient(135deg, rgba(244,63,94,0.14), rgba(0,0,0,0.12)); }
      .kpiBtn.warn{ border-color: rgba(245,158,11,0.26); background: linear-gradient(135deg, rgba(245,158,11,0.16), rgba(0,0,0,0.12)); }
      .kpiBtn.info{ border-color: rgba(96,165,250,0.24); background: linear-gradient(135deg, rgba(96,165,250,0.16), rgba(0,0,0,0.12)); }
    }
    @media (hover:hover){
      .kpiBtn:hover{
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(2, 6, 23, 0.10);
      }
      @media (prefers-color-scheme: dark){
        .kpiBtn:hover{
          box-shadow: 0 8px 24px rgba(0,0,0,0.45);
        }
      }
    }

    .kpiBtn:active{
      transform: scale(0.97);
      box-shadow: 0 2px 6px rgba(2, 6, 23, 0.08);
    }
    .kpiBtn[aria-current="true"]{
      transform: translateY(-1px);
      box-shadow: 0 0 0 3px var(--ring), 0 8px 24px rgba(2, 6, 23, 0.10);
      border-color: rgba(59,130,246,0.30);
    }
    @media (prefers-color-scheme: dark){
      .kpiBtn[aria-current="true"]{
        box-shadow: 0 0 0 3px var(--ring), 0 8px 24px rgba(0,0,0,0.45);
      }
    }

    .subTitle{
      margin-top: 2px;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.35;
    }

    .pageTitleRow{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .titleRight{
      display: inline-flex;
      gap: 12px;
      align-items: center;
      margin-left: auto;
    }
    .topBackRow{
      display: flex;
      align-items: center;
    }
    .metaSplit{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .metaLeft{
      display: inline-flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .backBtn{
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 7px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--chip-bg);
      cursor: pointer;
      font-size: 12.5px;
      color: var(--muted);
      line-height: 1;
      transition: background 160ms ease, border-color 160ms ease, transform 120ms ease;
    }
    @media (hover: hover){
      .backBtn:hover{
        background: rgba(59,130,246,0.06);
        border-color: rgba(59,130,246,0.18);
        color: var(--accent);
      }
    }
    .backBtn:active{ transform: scale(0.96); }

    .cardLink{
      cursor: pointer;
    }

    .cardLink:active{
      transform: scale(0.99) !important;
      box-shadow: var(--shadow2) !important;
    }

    .schoolTopRight{
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .hero{
      border-bottom: 1px solid var(--border);
      background: linear-gradient(135deg, rgba(99,102,241,0.12), rgba(59,130,246,0.14), rgba(16,185,129,0.10));
      padding: 16px 16px;
    }
    @media (prefers-color-scheme: dark){
      .hero{
        background: linear-gradient(135deg, rgba(99,102,241,0.18), rgba(59,130,246,0.20), rgba(16,185,129,0.14));
      }
    }

    .heroInner{
      display: grid;
      gap: 10px;
    }

    .heroImg{
      width: 100%;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.30);
      background: rgba(255,255,255,0.40);
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(2, 6, 23, 0.08);
    }
    @media (prefers-color-scheme: dark){
      .heroImg{ background: rgba(0,0,0,0.18); border-color: rgba(255,255,255,0.12); }
    }

    .heroImg svg{ display: block; width: 100%; height: auto; }

    .heroMeta{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .kv{
      display: grid;
      gap: 10px;
      padding: 12px 14px 14px;
    }

    .kvItem{
      display: grid;
      gap: 6px;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 14px 14px;
      background: rgba(255,255,255,0.70);
      transition: box-shadow 200ms ease;
    }
    @media (hover: hover){
      .kvItem:hover{ box-shadow: 0 4px 16px rgba(2, 6, 23, 0.06); }
    }
    @media (prefers-color-scheme: dark){
      .kvItem{ background: rgba(255,255,255,0.04); }
    }

    .kvLabel{
      font-size: 12px;
      color: var(--muted);
      font-weight: 760;
      letter-spacing: 0.2px;
    }

    .kvValue{
      font-size: 13.5px;
      font-weight: 740;
      letter-spacing: 0.2px;
      line-height: 1.4;
      word-break: break-word;
    }

    .linkPill{
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 7px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--chip-bg);
      cursor: pointer;
      text-decoration: none;
      color: var(--accent);
      font-size: 12.5px;
      font-weight: 680;
      line-height: 1;
      transition: background 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;
    }
    @media (hover: hover){
      .linkPill:hover{
        background: rgba(59,130,246,0.08);
        border-color: rgba(59,130,246,0.20);
        box-shadow: 0 2px 8px rgba(59,130,246,0.10);
      }
    }
    .linkPill:active{ transform: scale(0.96); }

    .bottomNav{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 30;
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: linear-gradient(to top, rgba(240,242,248,0.95), rgba(240,242,248,0.75), rgba(240,242,248,0.0));
      backdrop-filter: blur(20px) saturate(1.5);
      -webkit-backdrop-filter: blur(20px) saturate(1.5);
    }
    body.navHidden .bottomNav{
      transform: translateY(120%);
      opacity: 0;
      pointer-events: none;
    }
    @media (prefers-color-scheme: dark){
      .bottomNav{
        background: linear-gradient(to top, rgba(10,15,30,0.92), rgba(10,15,30,0.65), rgba(10,15,30,0.0));
      }
    }

    .bottomNavInner{
      width: min(480px, calc(100% - 16px));
      margin: 0 auto;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: 0 4px 24px rgba(2, 6, 23, 0.08), 0 1px 4px rgba(2, 6, 23, 0.04);
      padding: 6px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 4px;
    }
    @media (prefers-color-scheme: dark){
      .bottomNavInner{
        box-shadow: 0 4px 24px rgba(0,0,0,0.35), 0 1px 4px rgba(0,0,0,0.25);
      }
    }

    .navItem{
      display: grid;
      justify-items: center;
      align-items: center;
      gap: 4px;
      padding: 8px 8px 7px;
      border-radius: 16px;
      border: 1px solid transparent;
      cursor: pointer;
      user-select: none;
      transition: background 180ms ease, border-color 180ms ease, transform 120ms ease;
    }
    @media (hover: hover){
      .navItem:hover{
        background: rgba(59,130,246,0.06);
      }
    }
    .navItem:active{
      transform: scale(0.96);
    }

    .navIcon{
      width: 28px;
      height: 28px;
      border-radius: 10px;
      border: none;
      background: transparent;
      display: grid;
      place-items: center;
      color: var(--muted);
      transition: color 180ms ease, background 180ms ease;
    }

    .navLabel{
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.3px;
      color: var(--muted);
      line-height: 1;
      transition: color 180ms ease;
    }

    .navItem[aria-current="page"]{
      border-color: transparent;
      background: rgba(59,130,246,0.10);
    }
    .navItem[aria-current="page"] .navLabel{
      color: var(--accent);
      font-weight: 750;
    }
    .navItem[aria-current="page"] .navIcon{
      background: rgba(59,130,246,0.12);
      color: var(--accent);
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="top" class="top"></div>
    <main id="app" class="body" aria-live="polite"></main>
    <div class="foot" id="foot"></div>
  </div>

  <nav class="bottomNav" aria-label="底部导航">
    <div class="bottomNavInner">
      <button class="btn navItem focusable" type="button" data-nav="progress" aria-current="page">
        <div class="navIcon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 18V6"></path>
            <path d="M8 18V10"></path>
            <path d="M12 18V4"></path>
            <path d="M16 18V12"></path>
            <path d="M20 18V8"></path>
          </svg>
        </div>
        <div class="navLabel">进展</div>
      </button>
      <button class="btn navItem focusable" type="button" data-nav="plan" aria-current="false">
        <div class="navIcon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 6h13"></path>
            <path d="M8 12h13"></path>
            <path d="M8 18h13"></path>
            <path d="M3 6h.01"></path>
            <path d="M3 12h.01"></path>
            <path d="M3 18h.01"></path>
          </svg>
        </div>
        <div class="navLabel">计划</div>
      </button>
      <button class="btn navItem focusable" type="button" data-nav="school" aria-current="false">
        <div class="navIcon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 21h18"></path>
            <path d="M7 21V8l5-3 5 3v13"></path>
            <path d="M9 21v-6h6v6"></path>
          </svg>
        </div>
        <div class="navLabel">学校</div>
      </button>
    </div>
  </nav>

  <script>
    const updatedAt = "2026/02/13";
    const updatedAtISO = "2026-02-13";

    const Status = {
      ok: { key: "ok", label: "有位置", tagClass: "ok" },
      full: { key: "full", label: "满员", tagClass: "no" },
      pending: { key: "pending", label: "待确认", tagClass: "warn" },
      reply: { key: "reply", label: "待回复", tagClass: "info" },
    };

    const schools = [
      {
        id: "st-mary",
        cn: "圣玛丽",
        en: "St. Mary's International School",
        shortEn: "ST MARY",
        status: Status.ok,
        statusLabel: "部分可申请",
        availability: [
          { label: "1年级", valueTag: { text: "没有", cls: "no" }, note: "" },
          { label: "3年级", valueTag: { text: "有", cls: "ok" }, note: "" },
        ],
        intro:
          "东京世田谷区的国际学校（英语授课）。男校，K-12，提供IB课程信息（以官网为准）。",
        area: "东京｜世田谷区",
        website: "https://www.smis.ac.jp/",
        highlights: ["男校", "K-12", "IB课程（以官网为准）"],
        hero: { a: "#3b82f6", b: "#10b981", t: "SM" },
      },
      {
        id: "tis",
        cn: "东京国际",
        en: "Tokyo International School",
        shortEn: "TIS",
        status: Status.full,
        statusLabel: "满员",
        availability: [
          {
            label: "现状",
            valueTag: { text: "待确认", cls: "warn" },
            note: "目前是满的，暂时不确定是否会有位置空出来。",
          },
        ],
        intro:
          "东京港区的国际学校（英语授课）。IB World School（PYP/MYP/DP）信息以官网为准。",
        area: "东京｜港区（南麻布）",
        website: "https://tokyois.com/",
        highlights: ["IB（PYP/MYP/DP）", "市区位置", "招生以官网为准"],
        hero: { a: "#60a5fa", b: "#22c55e", t: "TIS" },
      },
      {
        id: "shinagawa",
        cn: "品川",
        en: "Shinagawa International School",
        shortEn: "SHINAGAWA",
        status: Status.ok,
        statusLabel: "部分可申请",
        availability: [
          { label: "1年级", valueTag: { text: "有", cls: "ok" }, note: "" },
          {
            label: "3年级",
            valueTag: { text: "暂时没有", cls: "no" },
            note: "确定会有一个空出来，但很有可能会优先给 waiting pool 的孩子。",
          },
        ],
        intro:
          "东京品川区域的国际学校（英语授课）。IB Continuum（PYP/MYP/DP）信息以官网为准。",
        area: "东京｜品川区",
        website: "https://sistokyo.jp/",
        highlights: ["IB Continuum（以官网为准）", "多校区信息以官网为准", "招生以官网为准"],
        hero: { a: "#3b82f6", b: "#f59e0b", t: "SIS" },
      },
      {
        id: "ymca",
        cn: "YMCA",
        en: "Tokyo YMCA International School",
        shortEn: "YMCA",
        status: Status.ok,
        statusLabel: "部分可申请",
        availability: [
          { label: "1年级", valueTag: { text: "有", cls: "ok" }, note: "" },
          { label: "3年级", valueTag: { text: "暂时没", cls: "no" }, note: "" },
        ],
        intro:
          "Tokyo YMCA International School（TYIS），英语授课，强调多元与社区氛围（以官网为准）。",
        area: "东京｜江东区（东阳）",
        website: "https://tokyo.ymca.or.jp/tyis/",
        highlights: ["英文授课", "多元社区（以官网为准）", "招生以官网为准"],
        hero: { a: "#10b981", b: "#06b6d4", t: "Y" },
      },
      {
        id: "aoba",
        cn: "青叶",
        en: "Aoba-Japan International School",
        shortEn: "AOBA",
        status: Status.ok,
        statusLabel: "可申请",
        availability: [
          { label: "1年级", valueTag: { text: "有", cls: "ok" }, note: "" },
          { label: "3年级", valueTag: { text: "有", cls: "ok" }, note: "" },
        ],
        intro:
          "Aoba-Japan International School，东京的国际学校（英语授课）。IB Continuum World School 信息以官网为准。",
        area: "东京｜多校区（以官网为准）",
        website: "https://japaninternationalschool.com/",
        highlights: ["IB Continuum（以官网为准）", "多校区（以官网为准）", "招生以官网为准"],
        hero: { a: "#22c55e", b: "#3b82f6", t: "A" },
      },
      {
        id: "yoyogi",
        cn: "代代木",
        en: "Yoyogi International School",
        shortEn: "YOYOGI",
        status: Status.pending,
        statusLabel: "待确认",
        availability: [
          {
            label: "现状",
            valueTag: { text: "待确认", cls: "warn" },
            note: "假期，暂时不知道学位情况。",
          },
        ],
        intro:
          "位于东京涩谷区域的国际学校（英语授课）。IB（PYP授权）与课程框架信息以官网为准。",
        area: "东京｜涩谷区（代代木/宇田川町）",
        website: "https://yoyogi-is.com/",
        highlights: ["IB PYP（以官网为准）", "小班制（以官网为准）", "招生以官网为准"],
        hero: { a: "#f59e0b", b: "#3b82f6", t: "YI" },
      },
      {
        id: "malvern",
        cn: "马文",
        en: "Malvern College Tokyo",
        shortEn: "MALVERN",
        status: Status.reply,
        statusLabel: "待回复",
        availability: [
          {
            label: "现状",
            valueTag: { text: "待回复", cls: "info" },
            note: "已发邮件，等回复。",
          },
        ],
        intro:
          "Malvern 体系东京校。IB World School（PYP/MYP/DP）与校区信息以官网为准。",
        area: "东京周边｜小平市（以官网为准）",
        website: "https://www.malverncollegetokyo.jp/",
        highlights: ["IB（PYP/MYP/DP）", "英式传统（以官网为准）", "招生以官网为准"],
        hero: { a: "#60a5fa", b: "#f97316", t: "M" },
      },
    ];

    const plans = [
      {
        when: "2/16",
        prio: "high",
        prioText: "优先级：高",
        badge: { text: "询问", cls: "warn" },
        what: "联系代代木（YOYOGI）：电话或邮件询问学位情况",
        detail: "确认：可申请年级、是否有名额、预计空出时间、需要的材料与截止时间。",
        schools: ["yoyogi"],
      },
      {
        when: "尽快",
        prio: "high",
        prioText: "优先级：高",
        badge: { text: "跟进", cls: "info" },
        what: "跟进 MALVERN（马文）：确认是否有位置",
        detail: "目标：拿到明确回复；如有位置，推进申请流程与预约沟通。",
        schools: ["malvern"],
      },
      {
        when: "2/21",
        prio: "mid",
        prioText: "优先级：中",
        badge: { text: "参与", cls: "ok" },
        what: "参加 AOBA（青叶）线上说明会",
        detail: "备注：无法参观学校，可通过线上说明会补足关键信息与提问。",
        schools: ["aoba"],
      },
      {
        when: "持续",
        prio: "mid",
        prioText: "优先级：中",
        badge: { text: "拓展", cls: "warn" },
        what: "继续寻找更多学校",
        detail: "补充备选项，降低满员/等待池带来的不确定性。",
        schools: [],
      },
    ];

    function esc(s) {
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function findSchool(id) {
      return schools.find((s) => s.id === id) || null;
    }

    function statusCount(key) {
      return schools.filter((s) => s.status.key === key).length;
    }

    function setNavCurrent(key) {
      document.querySelectorAll("[data-nav]").forEach((el) => {
        el.setAttribute("aria-current", el.getAttribute("data-nav") === key ? "page" : "false");
      });
    }

    function svgCardHero({ a, b, t, title, uid }) {
      const label = (t || "").slice(0, 3);
      const safeTitle = esc(title || "");
      const safeLabel = esc(label);
      const safeUid = esc(String(uid || "x").replace(/[^a-zA-Z0-9_-]/g, "_"));
      const gid = `g_${safeUid}`;
      const sid = `s_${safeUid}`;
      return `
        <svg viewBox="0 0 1200 520" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="${safeTitle}">
          <defs>
            <linearGradient id="${gid}" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="${esc(a)}" stop-opacity="0.92"/>
              <stop offset="100%" stop-color="${esc(b)}" stop-opacity="0.92"/>
            </linearGradient>
            <filter id="${sid}" x="-20%" y="-20%" width="140%" height="140%">
              <feDropShadow dx="0" dy="18" stdDeviation="22" flood-color="rgba(2,6,23,0.25)"/>
            </filter>
          </defs>
          <rect width="1200" height="520" fill="url(#${gid})"/>
          <circle cx="180" cy="120" r="160" fill="rgba(255,255,255,0.16)"/>
          <circle cx="1020" cy="420" r="210" fill="rgba(255,255,255,0.12)"/>
          <g filter="url(#${sid})">
            <rect x="90" y="120" width="1020" height="310" rx="28" fill="rgba(255,255,255,0.18)" stroke="rgba(255,255,255,0.22)"/>
          </g>
          <text x="140" y="260" font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial" font-size="98" font-weight="860" fill="rgba(255,255,255,0.92)">${safeLabel}</text>
          <text x="140" y="330" font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial" font-size="42" font-weight="700" fill="rgba(255,255,255,0.86)">${safeTitle}</text>
          <text x="140" y="390" font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial" font-size="28" font-weight="650" fill="rgba(255,255,255,0.76)">School Profile</text>
        </svg>
      `;
    }

    function linkToSchoolDetail(schoolId, from) {
      const cleanFrom = String(from || "school").replace(/^#/, "");
      return `#school/${esc(schoolId)}?from=${encodeURIComponent(cleanFrom)}`;
    }

    function schoolCard(s, from) {
      const rows = s.availability
        .map((r) => {
          const note = r.note ? `<div class="note">${esc(r.note)}</div>` : "";
          return `
            <div class="row">
              <div class="label">${esc(r.label)}</div>
              <div class="value">
                <div><span class="tag ${esc(r.valueTag.cls)}">${esc(r.valueTag.text)}</span></div>
                ${note}
              </div>
            </div>
          `;
        })
        .join("");

      const statusCls = {ok:'statusOk',no:'statusNo',warn:'statusWarn',info:'statusInfo'}[s.status.tagClass] || '';
      return `
        <article class="card cardLink focusable ${statusCls}" tabindex="0" role="link" data-link="${linkToSchoolDetail(s.id, from)}" aria-label="查看学校介绍：${esc(s.cn)}">
          <div class="cardTop">
            <div class="school">
              <div class="cn">${esc(s.cn)}（${esc(s.shortEn)}）</div>
              <div class="en">${esc(s.en)}</div>
            </div>
            <div class="schoolTopRight">
              <span class="tag ${esc(s.status.tagClass)}">${esc(s.statusLabel)}</span>
            </div>
          </div>
          <div class="rows">
            ${rows}
          </div>
        </article>
      `;
    }

    function compactSchoolCard(s) {
      const pills = (s.highlights || [])
        .slice(0, 3)
        .map((h) => `<span class="tag">${esc(h)}</span>`)
        .join("");

      const statusCls = {ok:'statusOk',no:'statusNo',warn:'statusWarn',info:'statusInfo'}[s.status.tagClass] || '';
      return `
        <article class="card cardLink focusable ${statusCls}" tabindex="0" role="link" data-link="#school/${esc(s.id)}" aria-label="查看学校介绍：${esc(s.cn)}">
          <div class="cardTop">
            <div class="school">
              <div class="cn">${esc(s.cn)}（${esc(s.shortEn)}）</div>
              <div class="en">${esc(s.en)}</div>
            </div>
            <div class="schoolTopRight">
              <span class="tag ${esc(s.status.tagClass)}">${esc(s.status.label)}</span>
            </div>
          </div>
          <div class="rows">
            <div class="row">
              <div class="label">简介</div>
              <div class="value">
                <div class="note">${esc(s.intro)}</div>
                <div class="legend" style="margin-top:6px;">${pills}</div>
              </div>
            </div>
          </div>
        </article>
      `;
    }

    function schoolDetailSection(s) {
      const tags = (s.highlights || []).map((h) => `<span class="tag">${esc(h)}</span>`).join("");
      const heroSvg = svgCardHero({ ...s.hero, title: `${s.cn} ${s.shortEn}`, uid: `list_${s.id}` });

      return `
        <section class="section" aria-label="学校介绍详情：${esc(s.cn)}">
          <div class="hero">
            <div class="heroInner">
              <div class="heroImg">${heroSvg}</div>
              <div class="heroMeta">
                <span class="tag ${esc(s.status.tagClass)}">${esc(s.status.label)}</span>
                ${tags}
              </div>
            </div>
          </div>

          <div class="kv">
            <div class="kvItem">
              <div class="kvLabel">学校名称</div>
              <div class="kvValue">${esc(s.cn)}（${esc(s.en)}）</div>
            </div>
            <div class="kvItem">
              <div class="kvLabel">区域</div>
              <div class="kvValue">${esc(s.area || "以官网为准")}</div>
            </div>
            <div class="kvItem">
              <div class="kvLabel">简介</div>
              <div class="kvValue">${esc(s.intro)}</div>
            </div>
            <div class="kvItem">
              <div class="kvLabel">官网</div>
              <div class="kvValue">
                <a class="linkPill focusable" href="${esc(s.website)}" target="_blank" rel="noreferrer">打开官网</a>
              </div>
            </div>
          </div>
        </section>
      `;
    }

    function getSummaryHtml(activeKey) {
      return `
        <div class="summary" aria-label="按状态筛选">
          <button class="btn kpi kpiBtn ok focusable" type="button" data-link="#progress/status/ok" aria-label="查看有位置学校" aria-current="${activeKey === "ok" ? "true" : "false"}">
            <div class="n">${statusCount("ok")}</div>
            <div class="l">${esc(Status.ok.label)}</div>
          </button>
          <button class="btn kpi kpiBtn no focusable" type="button" data-link="#progress/status/full" aria-label="查看满员学校" aria-current="${activeKey === "full" ? "true" : "false"}">
            <div class="n">${statusCount("full")}</div>
            <div class="l">${esc(Status.full.label)}</div>
          </button>
          <button class="btn kpi kpiBtn warn focusable" type="button" data-link="#progress/status/pending" aria-label="查看待确认学校" aria-current="${activeKey === "pending" ? "true" : "false"}">
            <div class="n">${statusCount("pending")}</div>
            <div class="l">${esc(Status.pending.label)}</div>
          </button>
          <button class="btn kpi kpiBtn info focusable" type="button" data-link="#progress/status/reply" aria-label="查看待回复学校" aria-current="${activeKey === "reply" ? "true" : "false"}">
            <div class="n">${statusCount("reply")}</div>
            <div class="l">${esc(Status.reply.label)}</div>
          </button>
        </div>
      `;
    }

    function renderTop({ title, subtitle, showSummary, backTo, showUpdatedAt = true, inlineUpdatedAt = false, inlineSubtitle = false, summaryActiveKey = "" }) {
      const top = document.getElementById("top");
      const summaryHtml = showSummary ? getSummaryHtml(summaryActiveKey) : "";

      const backHtml = backTo
        ? `<button class="btn backBtn focusable" type="button" data-link="${esc(backTo)}" aria-label="返回">← 返回</button>`
        : "";

      const updatedHtml = showUpdatedAt
        ? `<span class="chip">更新：<time datetime="${esc(updatedAtISO)}">${esc(updatedAt)}</time></span>`
        : "";
      const subtitleHtml = subtitle ? `<span class="chip">${esc(subtitle)}</span>` : "";
      const titleRight = inlineUpdatedAt || backHtml
        ? `<div class="titleRight">${inlineUpdatedAt ? updatedHtml : ""}${inlineUpdatedAt && inlineSubtitle ? subtitleHtml : ""}${backHtml}</div>`
        : "";
      const metaHtml = !inlineUpdatedAt && (updatedHtml || subtitleHtml)
        ? `<div class="meta">${updatedHtml}${subtitleHtml}</div>`
        : subtitleHtml
          ? `<div class="meta">${subtitleHtml}</div>`
          : "";

      top.innerHTML = `
        <div class="headerCard">
          <div class="headerMain">
            <div class="titleRow">
              <div class="pageTitleRow">
                <h1>${esc(title)}</h1>
                ${titleRight}
              </div>
              ${metaHtml}
              ${summaryHtml}
            </div>
          </div>
        </div>
      `;
    }

    function renderProgressHome() {
      setNavCurrent("progress");
      renderTop({
        title: "学校联系进展",
        subtitle: "",
        showSummary: true,
        backTo: null,
        showUpdatedAt: true,
        inlineUpdatedAt: true,
      });

      const from = location.hash.replace(/^#/, "") || "progress";
      const app = document.getElementById("app");
      app.innerHTML = `
        <section class="section" aria-label="学位情况">
          <div class="sectionHead">
            <h2>学位情况</h2>
            <div class="legend">
              <span class="chip">可点击学校名称进入介绍</span>
            </div>
          </div>
          <div class="cards">
            ${schools.map((s) => schoolCard(s, from)).join("")}
          </div>
        </section>
      `;

      document.getElementById("foot").textContent =
        "提示：底部可切换「进展 / 计划 / 学校介绍」。学校卡片可点进介绍页。";
    }

    function renderProgressFiltered(statusKey) {
      const st = Status[statusKey] || null;
      if (!st) {
        navigate("#progress");
        return;
      }
      setNavCurrent("progress");
      renderTop({
        title: "学校联系进展",
        subtitle: "",
        showSummary: true,
        backTo: "#progress",
        showUpdatedAt: false,
        summaryActiveKey: statusKey,
      });

      const from = location.hash.replace(/^#/, "") || `progress/status/${statusKey}`;
      const app = document.getElementById("app");
      const list = schools.filter((s) => s.status.key === statusKey);
      app.innerHTML = `
        <section class="section" aria-label="筛选结果">
          <div class="sectionHead">
            <h2>符合条件的学校（${list.length}）</h2>
            <div class="legend">
              <span class="tag ${esc(st.tagClass)}">${esc(st.label)}</span>
            </div>
          </div>
          <div class="cards">
            ${list.map((s) => schoolCard(s, from)).join("")}
          </div>
        </section>
      `;

      document.getElementById("foot").textContent =
        "提示：点击顶部四个状态可快速切换列表；点击学校进入「学校介绍」。";
    }

    function renderPlan() {
      setNavCurrent("plan");
      renderTop({
        title: "行动计划",
        subtitle: "",
        showSummary: false,
        backTo: null,
        showUpdatedAt: false,
      });

      const from = location.hash.replace(/^#/, "") || "plan";
      const app = document.getElementById("app");
      const actionsHtml = plans
        .map((p) => {
          const schoolPills =
            p.schools && p.schools.length
              ? `
                <div class="legend">
                  ${p.schools
                    .map((id) => {
                      const s = findSchool(id);
                      if (!s) return "";
                      return `<button class="btn linkPill focusable" type="button" data-link="${linkToSchoolDetail(s.id, from)}">${esc(s.cn)}（${esc(s.shortEn)}）</button>`;
                    })
                    .join("")}
                </div>
              `
              : "";

          return `
            <div class="action">
              <div class="actionTop">
                <div class="when">${esc(p.when)} <span class="tag ${esc(p.badge.cls)}">${esc(p.badge.text)}</span></div>
                <div class="prio ${esc(p.prio)}">${esc(p.prioText)}</div>
              </div>
              <div class="what">${esc(p.what)}</div>
              <div class="detail">${esc(p.detail)}</div>
              ${schoolPills}
            </div>
          `;
        })
        .join("");

      app.innerHTML = `
        <section class="section" aria-label="后续行动计划">
          <div class="sectionHead">
            <h2>后续行动计划</h2>
            <div class="legend">
              <span class="chip">可点学校名称进入介绍页</span>
            </div>
          </div>
          <div class="actions">
            ${actionsHtml}
          </div>
        </section>
      `;

      document.getElementById("foot").textContent =
        "提示：从「计划」也可以进入学校介绍页，方便客户了解学校背景。";
    }

    function renderSchoolList() {
      setNavCurrent("school");
      renderTop({
        title: "学校介绍",
        subtitle: "",
        showSummary: false,
        backTo: null,
        showUpdatedAt: false,
      });

      const app = document.getElementById("app");
      app.innerHTML = schools.map(schoolDetailSection).join("");

      document.getElementById("foot").textContent = "";
    }

    function renderSchoolDetail(id, from) {
      const s = findSchool(id);
      if (!s) {
        navigate("#school");
        return;
      }
      setNavCurrent("school");
      const backTo = from ? `#${String(from).replace(/^#/, "")}` : "#school";
      renderTop({
        title: `学校介绍｜${s.cn}`,
        subtitle: "可返回列表或继续切换底部导航",
        showSummary: false,
        backTo,
        showUpdatedAt: false,
      });

      const app = document.getElementById("app");
      const tags = (s.highlights || []).map((h) => `<span class="tag">${esc(h)}</span>`).join("");
      const heroSvg = svgCardHero({ ...s.hero, title: `${s.cn} ${s.shortEn}`, uid: `detail_${s.id}` });

      app.innerHTML = `
        <section class="section" aria-label="学校介绍详情">
          <div class="hero">
            <div class="heroInner">
              <div class="heroImg">${heroSvg}</div>
              <div class="heroMeta">
                <span class="tag ${esc(s.status.tagClass)}">${esc(s.status.label)}</span>
                ${tags}
              </div>
            </div>
          </div>

          <div class="kv">
            <div class="kvItem">
              <div class="kvLabel">学校名称</div>
              <div class="kvValue">${esc(s.cn)}（${esc(s.en)}）</div>
            </div>
            <div class="kvItem">
              <div class="kvLabel">区域</div>
              <div class="kvValue">${esc(s.area || "以官网为准")}</div>
            </div>
            <div class="kvItem">
              <div class="kvLabel">简介</div>
              <div class="kvValue">${esc(s.intro)}</div>
            </div>
            <div class="kvItem">
              <div class="kvLabel">官网</div>
              <div class="kvValue">
                <a class="linkPill focusable" href="${esc(s.website)}" target="_blank" rel="noreferrer">打开官网</a>
              </div>
            </div>
          </div>
        </section>
      `;

      document.getElementById("foot").textContent =
        "";
    }

    function parseRoute(hash) {
      const h = (hash || "#progress").replace(/^#/, "");
      const [pathPart, queryPart] = h.split("?");
      const parts = String(pathPart || "").split("/").filter(Boolean);
      const params = new URLSearchParams(queryPart || "");
      const page = parts[0] || "progress";
      if (page === "progress" && parts[1] === "status" && parts[2]) {
        return { page: "progressStatus", status: parts[2] };
      }
      if (page === "plan") return { page: "plan" };
      if (page === "school" && parts[1]) return { page: "schoolDetail", id: parts[1], from: params.get("from") || "" };
      if (page === "school") return { page: "school" };
      return { page: "progress" };
    }

    function navigate(hash) {
      if (!hash.startsWith("#")) hash = "#" + hash;
      if (location.hash === hash) {
        render();
        return;
      }
      location.hash = hash;
    }

    function render() {
      const route = parseRoute(location.hash);
      if (route.page === "progress") renderProgressHome();
      else if (route.page === "progressStatus") renderProgressFiltered(route.status);
      else if (route.page === "plan") renderPlan();
      else if (route.page === "school") renderSchoolList();
      else if (route.page === "schoolDetail") renderSchoolDetail(route.id, route.from);
      else renderProgressHome();
    }

    function onActivateLink(el) {
      const to = el.getAttribute("data-link");
      if (to) navigate(to);
    }

    document.addEventListener("click", (e) => {
      const linkEl = e.target.closest("[data-link]");
      if (linkEl) {
        e.preventDefault();
        onActivateLink(linkEl);
        return;
      }
      const navEl = e.target.closest("[data-nav]");
      if (navEl) {
        e.preventDefault();
        const key = navEl.getAttribute("data-nav");
        if (key === "progress") navigate("#progress");
        else if (key === "plan") navigate("#plan");
        else if (key === "school") navigate("#school");
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key !== "Enter" && e.key !== " ") return;
      const linkEl = e.target.closest('[role="link"][data-link], button[data-link]');
      if (linkEl) {
        e.preventDefault();
        onActivateLink(linkEl);
      }
    });

    window.addEventListener("hashchange", render);

    if (!location.hash) location.hash = "#progress";
    render();

    (function () {
      let lastY = window.scrollY || 0;
      let acc = 0;
      let hidden = false;
      let ticking = false;
      const threshold = 10;

      function setHidden(next) {
        if (next === hidden) return;
        hidden = next;
        document.body.classList.toggle("navHidden", hidden);
      }

      function onScroll() {
        const y = window.scrollY || 0;
        const dy = y - lastY;
        lastY = y;

        if (y < 8) {
          acc = 0;
          setHidden(false);
          return;
        }

        if (Math.abs(dy) < 2) return;

        const nextAcc = acc + dy;
        acc = Math.sign(nextAcc) !== Math.sign(dy) ? dy : nextAcc;

        if (!hidden && acc > threshold) {
          acc = 0;
          setHidden(true);
        } else if (hidden && acc < -threshold) {
          acc = 0;
          setHidden(false);
        }
      }

      window.addEventListener(
        "scroll",
        () => {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(() => {
            ticking = false;
            onScroll();
          });
        },
        { passive: true }
      );
    })();
  </script>
</body>
</html>
